<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
        <title>ws-test</title>
	</head>
    
    <script>


        fetch('http://localhost:3000/create', {
            method: 'POST'
        })
        .then(res => res.json())
        .then(res => {
            
            const div = document.getElementById('game');

            div.innerHTML = res.gameId;
            
            console.log(res);

            let socket = new WebSocket('ws://localhost:3000'); 
            socket.onopen = () => {
                socket.send(JSON.stringify({
                    type: 0,
                    name: 'player1',
                    gameId: res.gameId,
                    token: res.token,
                }));
            };

            socket.onmessage = (m) => {
                console.log('MESSAGE', m);
            }
            socket.onclose = () => console.log('CLOSE');
            socket.onerror = () => console.log('ERROR');

            setInterval(() => {
                socket.send(JSON.stringify({
                    type: -1,
                    gameId: res.gameId,
                    token: res.token + '4',
                    payload: 'my_test'
                }));
            }, 1000);
        });

    </script>

    <body>
        <div id="game"></div>
    </body>
</html>