<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
        <title>ws-test</title>
	</head>
    
    <script>


        fetch('http://localhost:3000/create', {
            method: 'POST',
            headers: {
                'content-type': 'application/json'
            },
            body: JSON.stringify({
                name: 'j0nas',
            })
        })
        .then(res => res.json())
        .then(res => {
            
            const div = document.getElementById('game');

            div.innerHTML = res.gameId;
            
            console.log(res);

            let socket = new WebSocket('ws://localhost:3000'); 
            socket.onopen = () => {
                socket.send(JSON.stringify({
                    type: 'connect',
                    gameId: res.gameId,
                    token: res.token,
                }));

                // setInterval(() => {
                //     socket.send(JSON.stringify({
                //         type: 'status',
                //         gameId: res.gameId,
                //         token: res.token,
                //     }));
                // }, 5000);

                setTimeout(() => {
                    socket.send(JSON.stringify({
                        type: 'status',
                        gameId: res.gameId,
                        token: res.token,
                    }));
                }, 1000);

                setTimeout(() => {
                    socket.send(JSON.stringify({
                        type: 'shoot',
                        gameId: res.gameId,
                        token: res.token,
                        index: 12
                    }));
                }, 2000);

                setTimeout(() => {
                    socket.send(JSON.stringify({
                        type: 'status',
                        gameId: res.gameId,
                        token: res.token,
                    }));
                }, 5000);
                
            };

            socket.onmessage = (m) => {
                console.log(JSON.parse(m.data));
            }
            socket.onclose = () => console.log('CLOSE');
            socket.onerror = () => console.log('ERROR');

            // setInterval(() => {
            //     socket.send(JSON.stringify({
            //         type: -1,
            //         gameId: res.gameId,
            //         token: res.token + '4',
            //         payload: 'my_test'
            //     }));
            // }, 1000);
        });

    </script>

    <body>
        <div id="game"></div>
    </body>
</html>